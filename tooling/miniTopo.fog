for i in 0..4 do
	def n{i}
end for

connect n0 n1 180ms
connect n0 n2 180ms
connect n1 n2 180ms
connect n1 n3 180ms
connect n2 n3 180ms
connect n0 n3 180ms

build-network

run n1 netns n1 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/invokeBitcoin.sh 0 -dificulta=0 -dbcache=3072
run n2 netns n2 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/invokeBitcoin.sh 1 -dificulta=0 -dbcache=3072
run n3 netns n3 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/invokeBitcoin.sh 2 -dificulta=0 -dbcache=3072

run n0 netns n0 sleep 30s
run n1 netns n1 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/semaphore.go 0
run n2 netns n2 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/semaphore.go 1
run n3 netns n3 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/semaphore.go 2

run n1 netns n1 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/connectNodes.sh 0 1 n2
run n1 netns n1 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/connectNodes.sh 0 2 n3
run n2 netns n2 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/connectNodes.sh 1 0 n1
run n2 netns n2 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/connectNodes.sh 1 2 n3
run n3 netns n3 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/connectNodes.sh 2 0 n1
run n3 netns n3 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/connectNodes.sh 2 1 n2

run n0 netns n0 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/invokeBitcoin.sh 3 -dificulta=0 -dbcache=3072

run n0 netns n0 sleep 30s
run n0 netns n0 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/semaphore.go 3

run n1 netns n1 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/connectNodes.sh 0 3 n0
run n0 netns n0 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/connectNodes.sh 3 0 n1
run n2 netns n2 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/connectNodes.sh 1 3 n0
run n0 netns n0 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/connectNodes.sh 3 1 n2
run n3 netns n3 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/connectNodes.sh 2 3 n0
run n0 netns n0 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/connectNodes.sh 3 2 n3

run n1 netns n1 rm -f /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/.exec-results/addrN*
run n2 netns n2 rm -f /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/.exec-results/addrN*

run n1 netns n1 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/bitcoindo.sh 0 getnewaddress > /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/.exec-results/addrN0
run n1 netns n1 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/bitcoindo.sh 0 getnewaddress >> /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/.exec-results/addrN0

run n2 netns n2 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/bitcoindo.sh 1 getnewaddress > /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/.exec-results/addrN1
run n2 netns n2 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/bitcoindo.sh 1 getnewaddress >> /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/.exec-results/addrN1

run n3 netns n3 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/bitcoindo.sh 2 getnewaddress > /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/.exec-results/addrN2
run n3 netns n3 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/bitcoindo.sh 2 getnewaddress >> /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/.exec-results/addrN2

run n1 netns n1 scp -q -o StrictHostKeyChecking=no /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/.exec-results/addrN* n0:/home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/.exec-results
run n2 netns n2 scp -q -o StrictHostKeyChecking=no /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/.exec-results/addrN* n0:/home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/.exec-results

run n0 netns n0 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/generateBlockchain.go 3

run n0 netns n0 sleep 30s
run n1 netns n1 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/semaphore.go 0
run n2 netns n2 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/semaphore.go 1
run n3 netns n3 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/semaphore.go 2

run n0 netns n0 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/bitcoindo.sh 3 stop


run n0 netns n0 sleep 1m

run n0 netns n0 rm /root/btcCoreLogN3

run n0 netns n0 rm -r /home/ndecarli/regtestData/3
run n1 netns n1 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/launcher.go /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/testEngine.go 0 0.400000

run n0 netns n0 sleep 1s
run n2 netns n2 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/launcher.go /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/testEngine.go 1 0.300000

run n0 netns n0 sleep 1s
run n3 netns n3 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/launcher.go /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/testEngine.go 2 0.300000

run n0 netns n0 sleep 1s

run n1 netns n1 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/launcher.go /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/pingEngine.go 4 1
run n2 netns n2 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/launcher.go /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/pingEngine.go 4 2
run n3 netns n3 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/launcher.go /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/pingEngine.go 4 3
run n0 netns n0 /usr/local/go/bin/go run /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/pingEngine.go 4 0

run n1 netns n1 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/bitcoindo.sh 0 stop
run n2 netns n2 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/bitcoindo.sh 1 stop
run n3 netns n3 bash /home/mgeier/mpizzagalli/bitcoin/tooling/ejecucion-nodos/bitcoindo.sh 2 stop

run n0 netns n0 sleep 1m
